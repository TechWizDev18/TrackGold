{% extends "base.html" %}

{% block title %}Dashboard - GoldTracker{% endblock %}

{% block content %}
<!-- Dashboard Header with Live Stats -->
<div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
    <!-- Current Price Card -->
    <div class="glass-effect rounded-2xl p-6 shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
        <div class="flex items-center justify-between mb-3">
            <div class="bg-yellow-500/20 p-3 rounded-lg">
                <i class="fas fa-coins text-2xl text-yellow-500"></i>
            </div>
            <span class="text-xs text-gray-400">LIVE</span>
        </div>
        <p class="text-sm text-gray-400 mb-1">Current Gold Price</p>
        <h3 id="dash-price" class="text-3xl font-bold text-yellow-500 mb-2">$4,263.40</h3>
        <p id="dash-change" class="text-sm price-up">
            <i class="fas fa-arrow-up mr-1"></i>+$42.90 (1.02%)
        </p>
    </div>

    <!-- Recommendation Card -->
    <div class="glass-effect rounded-2xl p-6 shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
        <div class="flex items-center justify-between mb-3">
            <div class="bg-green-500/20 p-3 rounded-lg">
                <i class="fas fa-signal text-2xl text-green-500"></i>
            </div>
            <span class="text-xs text-green-400">ACTIVE</span>
        </div>
        <p class="text-sm text-gray-400 mb-1">AI Recommendation</p>
        <h3 id="dash-recommendation" class="text-3xl font-bold text-green-400 mb-2">BUY</h3>
        <p class="text-sm text-gray-400">Medium Risk â€¢ Medium-term</p>
    </div>

    <!-- Target Price Card -->
    <div class="glass-effect rounded-2xl p-6 shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
        <div class="flex items-center justify-between mb-3">
            <div class="bg-blue-500/20 p-3 rounded-lg">
                <i class="fas fa-bullseye text-2xl text-blue-500"></i>
            </div>
            <span class="text-xs text-blue-400">TARGET</span>
        </div>
        <p class="text-sm text-gray-400 mb-1">Price Target</p>
        <h3 id="dash-target" class="text-3xl font-bold text-blue-400 mb-2">$4,380</h3>
        <p class="text-sm text-gray-400">Potential: +2.74%</p>
    </div>

    <!-- Position Size Card -->
    <div class="glass-effect rounded-2xl p-6 shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
        <div class="flex items-center justify-between mb-3">
            <div class="bg-purple-500/20 p-3 rounded-lg">
                <i class="fas fa-chart-pie text-2xl text-purple-500"></i>
            </div>
            <span class="text-xs text-purple-400">ALLOCATION</span>
        </div>
        <p class="text-sm text-gray-400 mb-1">Position Size</p>
        <h3 id="dash-position" class="text-3xl font-bold text-purple-400 mb-2">12%</h3>
        <p class="text-sm text-gray-400">Of Portfolio</p>
    </div>
</div>

<!-- Main Content Grid -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Left Column - Chart & Technical -->
    <div class="lg:col-span-2 space-y-8">
        <!-- Price Chart -->
        <div class="glass-effect rounded-2xl p-6 shadow-xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold flex items-center">
                    <i class="fas fa-chart-area mr-3 text-yellow-500"></i>
                    Gold Price Analysis
                </h2>
                <div class="flex space-x-2">
                    <button onclick="updateChartPeriod('1mo')" class="chart-period-btn px-4 py-2 text-sm rounded-lg bg-white/10 hover:bg-white/20 transition">1M</button>
                    <button onclick="updateChartPeriod('3mo')" class="chart-period-btn px-4 py-2 text-sm rounded-lg bg-white/10 hover:bg-white/20 transition">3M</button>
                    <button onclick="updateChartPeriod('6mo')" class="chart-period-btn active px-4 py-2 text-sm rounded-lg bg-yellow-500 text-gray-900 font-semibold">6M</button>
                    <button onclick="updateChartPeriod('1y')" class="chart-period-btn px-4 py-2 text-sm rounded-lg bg-white/10 hover:bg-white/20 transition">1Y</button>
                </div>
            </div>
            <div id="price-chart" class="h-96"></div>
        </div>

        <!-- Technical Indicators -->
        <div class="glass-effect rounded-2xl p-6 shadow-xl">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-signal mr-3 text-blue-500"></i>
                Technical Indicators
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-white/5 rounded-lg p-4 border border-white/10">
                    <p class="text-xs text-gray-400 mb-1">10-Day SMA</p>
                    <p class="text-xl font-bold text-blue-400">$4,117</p>
                    <p class="text-xs text-green-400 mt-1"><i class="fas fa-arrow-up"></i> Above 50-SMA</p>
                </div>
                <div class="bg-white/5 rounded-lg p-4 border border-white/10">
                    <p class="text-xs text-gray-400 mb-1">50-Day SMA</p>
                    <p class="text-xl font-bold text-orange-400">$3,995</p>
                    <p class="text-xs text-gray-400 mt-1">Support Level</p>
                </div>
                <div class="bg-white/5 rounded-lg p-4 border border-white/10">
                    <p class="text-xs text-gray-400 mb-1">RSI (14)</p>
                    <p class="text-xl font-bold text-red-400">72.74</p>
                    <p class="text-xs text-red-400 mt-1"><i class="fas fa-exclamation-triangle"></i> Overbought</p>
                </div>
                <div class="bg-white/5 rounded-lg p-4 border border-white/10">
                    <p class="text-xs text-gray-400 mb-1">Momentum</p>
                    <p class="text-xl font-bold text-green-400">Bullish</p>
                    <p class="text-xs text-green-400 mt-1"><i class="fas fa-check"></i> Strong</p>
                </div>
            </div>
        </div>

        <!-- News & Sentiment -->
        <div class="glass-effect rounded-2xl p-6 shadow-xl">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-newspaper mr-3 text-orange-500"></i>
                Market Sentiment
            </h2>
            <div class="space-y-4">
                <div class="bg-gradient-to-r from-green-900/30 to-green-800/20 border border-green-500/30 rounded-lg p-4">
                    <div class="flex items-start">
                        <div class="bg-green-500/20 p-2 rounded-lg mr-3">
                            <i class="fas fa-arrow-trend-up text-green-400"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-green-400 mb-1">Bullish Sentiment</h4>
                            <p class="text-sm text-gray-300">Gold breaks records as investors seek shelter from market turbulence</p>
                            <div class="flex items-center mt-2">
                                <span class="text-xs bg-green-500/20 text-green-300 px-2 py-1 rounded">Safe-Haven Demand</span>
                                <span class="text-xs text-gray-500 ml-2">2 hours ago</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white/5 border border-white/10 rounded-lg p-4">
                    <div class="flex items-start">
                        <div class="bg-blue-500/20 p-2 rounded-lg mr-3">
                            <i class="fas fa-university text-blue-400"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-300 mb-1">Federal Reserve Watch</h4>
                            <p class="text-sm text-gray-400">Monitoring interest rate decisions and policy statements</p>
                            <div class="flex items-center mt-2">
                                <span class="text-xs bg-blue-500/20 text-blue-300 px-2 py-1 rounded">Monetary Policy</span>
                                <span class="text-xs text-gray-500 ml-2">Updated daily</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column - Recommendations & Details -->
    <div class="space-y-8">
        <!-- AI Recommendation Card -->
        <div class="glass-effect rounded-2xl p-6 shadow-xl border-2 border-green-500/30">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold flex items-center">
                    <i class="fas fa-robot mr-2 text-purple-400"></i>
                    AI Analysis
                </h2>
                <span class="bg-green-500/20 text-green-400 text-xs px-3 py-1 rounded-full font-semibold">ACTIVE</span>
            </div>
            
            <div class="mb-6">
                <div class="flex items-center justify-center mb-3">
                    <div class="bg-gradient-to-r from-green-500 to-emerald-500 text-white text-3xl font-bold px-8 py-4 rounded-xl shadow-lg">
                        BUY
                    </div>
                </div>
                <p class="text-center text-sm text-gray-400">Medium-term position (weeks)</p>
            </div>

            <div class="space-y-4">
                <div class="bg-white/5 rounded-lg p-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-400">Entry Price</span>
                        <span class="text-lg font-bold text-green-400">$4,117.47</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div class="bg-green-500 h-2 rounded-full" style="width: 75%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Wait for pullback to 10-day SMA</p>
                </div>

                <div class="bg-white/5 rounded-lg p-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-400">Stop-Loss</span>
                        <span class="text-lg font-bold text-red-400">$3,980.00</span>
                    </div>
                    <p class="text-xs text-gray-500">3.34% below entry</p>
                </div>

                <div class="bg-white/5 rounded-lg p-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm text-gray-400">Target Price</span>
                        <span class="text-lg font-bold text-blue-400">$4,380.00</span>
                    </div>
                    <p class="text-xs text-gray-500">6.38% upside potential</p>
                </div>
            </div>

            <div class="mt-6 pt-6 border-t border-white/10">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-sm text-gray-400">Risk Level</span>
                    <span class="bg-yellow-500/20 text-yellow-400 text-xs px-3 py-1 rounded-full font-semibold">MEDIUM</span>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-400">Position Size</span>
                    <span class="text-lg font-bold text-purple-400">12%</span>
                </div>
            </div>

            <button onclick="runNewAnalysis()" class="w-full mt-6 btn-primary px-6 py-3 rounded-lg shadow-lg">
                <i class="fas fa-sync-alt mr-2"></i>Run New Analysis
            </button>
        </div>

        <!-- Risk Breakdown -->
        <div class="glass-effect rounded-2xl p-6 shadow-xl">
            <h3 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-shield-alt mr-2 text-yellow-500"></i>
                Risk Assessment
            </h3>
            
            <div class="space-y-3">
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span class="text-gray-400">Technical Risk</span>
                        <span class="text-yellow-400">High</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div class="bg-yellow-500 h-2 rounded-full" style="width: 75%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">RSI overbought - pullback likely</p>
                </div>

                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span class="text-gray-400">Fundamental Risk</span>
                        <span class="text-green-400">Low</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div class="bg-green-500 h-2 rounded-full" style="width: 25%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Strong safe-haven demand</p>
                </div>

                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span class="text-gray-400">Market Risk</span>
                        <span class="text-orange-400">Medium</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2">
                        <div class="bg-orange-500 h-2 rounded-full" style="width: 50%"></div>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">General market turbulence</p>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="glass-effect rounded-2xl p-6 shadow-xl">
            <h3 class="text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-bolt mr-2 text-yellow-500"></i>
                Quick Actions
            </h3>
            
            <div class="space-y-3">
                <button onclick="window.location.href='/analysis'" class="w-full bg-white/10 hover:bg-white/20 rounded-lg p-3 text-left transition">
                    <i class="fas fa-chart-line mr-2 text-blue-400"></i>
                    <span class="font-semibold">View Full Analysis</span>
                </button>
                
                <button onclick="downloadReport()" class="w-full bg-white/10 hover:bg-white/20 rounded-lg p-3 text-left transition">
                    <i class="fas fa-download mr-2 text-green-400"></i>
                    <span class="font-semibold">Download Report</span>
                </button>
                
                <button onclick="setAlert()" class="w-full bg-white/10 hover:bg-white/20 rounded-lg p-3 text-left transition">
                    <i class="fas fa-bell mr-2 text-yellow-400"></i>
                    <span class="font-semibold">Set Price Alert</span>
                </button>
                
                <button onclick="shareAnalysis()" class="w-full bg-white/10 hover:bg-white/20 rounded-lg p-3 text-left transition">
                    <i class="fas fa-share-alt mr-2 text-purple-400"></i>
                    <span class="font-semibold">Share Analysis</span>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Initialize chart with sample data
function initChart() {
    const dates = [];
    const prices = [];
    const sma10 = [];
    const sma50 = [];
    
    // Generate sample data
    for (let i = 180; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        dates.push(date.toISOString().split('T')[0]);
        
        const basePrice = 3800 + Math.random() * 400;
        prices.push(basePrice);
        sma10.push(basePrice * 0.98);
        sma50.push(basePrice * 0.96);
    }
    
    const trace1 = {
        x: dates,
        y: prices,
        type: 'scatter',
        mode: 'lines',
        name: 'Gold Price',
        line: { color: '#eab308', width: 2 }
    };
    
    const trace2 = {
        x: dates,
        y: sma10,
        type: 'scatter',
        mode: 'lines',
        name: '10-Day SMA',
        line: { color: '#3b82f6', width: 1.5 }
    };
    
    const trace3 = {
        x: dates,
        y: sma50,
        type: 'scatter',
        mode: 'lines',
        name: '50-Day SMA',
        line: { color: '#f59e0b', width: 1.5 }
    };
    
    const layout = {
        plot_bgcolor: 'rgba(0,0,0,0)',
        paper_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#e5e7eb' },
        xaxis: { 
            gridcolor: 'rgba(255,255,255,0.1)',
            showgrid: true
        },
        yaxis: { 
            gridcolor: 'rgba(255,255,255,0.1)',
            showgrid: true,
            title: 'Price (USD)'
        },
        margin: { t: 20, r: 20, b: 40, l: 60 },
        legend: {
            orientation: 'h',
            y: 1.1
        },
        hovermode: 'x unified'
    };
    
    Plotly.newPlot('price-chart', [trace1, trace2, trace3], layout, {responsive: true});
}

function updateChartPeriod(period) {
    // Update button states
    document.querySelectorAll('.chart-period-btn').forEach(btn => {
        btn.classList.remove('active', 'bg-yellow-500', 'text-gray-900', 'font-semibold');
        btn.classList.add('bg-white/10');
    });
    event.target.classList.add('active', 'bg-yellow-500', 'text-gray-900', 'font-semibold');
    event.target.classList.remove('bg-white/10');
    
    // Fetch new data (implement API call)
    console.log('Updating chart for period:', period);
}

function runNewAnalysis() {
    if (confirm('Run a new AI analysis? This will take 1-2 minutes.')) {
        window.location.href = '/analysis';
    }
}

function downloadReport() {
    alert('Downloading latest analysis report...');
}

function setAlert() {
    const price = prompt('Enter price alert level:');
    if (price) {
        alert(`Price alert set for $${price}`);
    }
}

function shareAnalysis() {
    alert('Share functionality coming soon!');
}

// Auto-refresh price
setInterval(() => {
    fetch('/api/gold-price')
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                document.getElementById('dash-price').textContent = '$' + data.price.toFixed(2);
                const changeEl = document.getElementById('dash-change');
                const sign = data.change >= 0 ? '+' : '';
                changeEl.innerHTML = `<i class="fas fa-arrow-${data.change >= 0 ? 'up' : 'down'} mr-1"></i>${sign}$${Math.abs(data.change).toFixed(2)} (${Math.abs(data.change_pct).toFixed(2)}%)`;
                changeEl.className = data.change >= 0 ? 'text-sm price-up' : 'text-sm price-down';
            }
        });
}, 30000);

// Initialize on load
initChart();
</script>
{% endblock %}